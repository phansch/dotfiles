#!/usr/bin/env bash

aptget='sudo apt-get'

function ansible()
{
  sudo apt-add-repository ppa:ansible/ansible -y
  $aptget update -qq
  $aptget install -qq software-properties-common ansible
}

function cleanup()
{
  # Run this before, to get app list: sed -nrs '/^\[Desktop Entry\]/d;/^(\[|Name=|Exec=)/p;${g;p}' /usr/share/applications/*.desktop > $HOME/Desktop/Names-n-Commands.txt
  echo 'Updating and autocleaning packages..'
  $aptget update -qq
  $aptget autoremove -qq && sudo aptitude autoclean -q2
  $aptget upgrade -y -qq
}

function packages_setup()
{
  echo 'Installing additional packages..'

  # Installing RVM + Ruby
  gpg -q --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3
  cd $HOME && \curl -L https://get.rvm.io | bash -s stable --ruby --auto-dotfiles
  source $HOME/.rvm/scripts/rvm

  # Installing tmuxinator
  gem install -q tmuxinator
}

function ssh_save()
{
  while true; do
    read -p "Do you want to add your ssh key to ssh-agent? " yn
    case $yn in
        [y]* ) ssh-add $HOME/.ssh/id_rsa &>/dev/null; break;;
        [n]* ) break;;
        * ) echo "Please answer yes (y) or no (n).";;
    esac
  done
}

function fix_git_gnome_keyring()
{
  $aptget install -qq libgnome-keyring-dev
  cd /usr/share/doc/git/contrib/credential/gnome-keyring
  sudo make
}

function finish()
{
  while true; do
    read -p "Almost done. Do you want to re-login now to complete the setup? " yn
    case $yn in
        [y]* ) xfce4-session-logout --logout; break;;
        [n]* ) exit;;
        * ) echo "Please answer yes (y) or no (n).";;
    esac
  done
}

cleanup
ansible
